<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·Šæ€¥æ•‘æ´èˆ‡ç¯€å¥è¼”åŠ© APP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'app-red': '#FF0000', // é®®ç´…è‰²
                        'app-white': '#FFFFFF', // ç´”ç™½è‰²èƒŒæ™¯
                    }
                }
            }
        }
    </script>
    <style>
        /* è®“æ‰‹æ©Ÿ App ç•«é¢ç½®ä¸­ä¸¦é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œå¢å¼·æ‰‹æ©Ÿè¦–è¦ºæ•ˆæœ */
        #app {
            max-width: 420px; /* æ¨¡æ“¬æ‰‹æ©Ÿå¯¬åº¦ */
            min-height: 100vh;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            background-color: #f7f7f7; /* è¼•å¾®çš„ç°ç™½è‰²èƒŒæ™¯ */
        }

        /* ç¯€æ‹å™¨å‹•ç•«ï¼šç°¡å–®çš„è„ˆè¡æ•ˆæœ */
        @keyframes beat {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.15);
                opacity: 1;
            }
        }

        .metronome-icon.beating {
            animation: beat 0.6s infinite alternate; /* å‡è¨­ç¯€å¥æ˜¯ 100 BPM (0.6ç§’/æ¬¡) */
        }
    </style>
</head>
<body class="bg-gray-100">

<div id="app" class="font-sans">
    
    <header class="bg-app-red p-4 shadow-lg text-white text-center font-bold text-xl">
        ğŸš¨ ç·Šæ€¥æ•‘æ´èˆ‡ç¯€å¥è¼”åŠ©
    </header>

    <main class="p-6 bg-app-white flex flex-col gap-6">

        <section class="bg-gray-50 p-6 rounded-xl shadow-md border-t-4 border-app-red">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">ğŸµ ç¯€æ‹å™¨</h2>
            
            <div class="flex flex-col items-center gap-4">
                
                <p class="text-6xl font-extrabold text-app-red transition duration-300">{{ bpm }}</p>
                <p class="text-sm text-gray-500 mb-4">BPM (æ¯åˆ†é˜ç¯€æ‹æ•¸)</p>

                <svg @click="toggleMetronome" 
                     :class="{'beating': isMetronomeRunning, 'cursor-pointer': true, 'transition': true, 'duration-200': true}" 
                     class="metronome-icon w-24 h-24 text-app-red" 
                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>

                <button @click="toggleMetronome" 
                        :class="isMetronomeRunning ? 'bg-gray-400' : 'bg-app-red hover:bg-red-700'" 
                        class="mt-4 w-full py-3 text-lg text-white font-bold rounded-full shadow-lg transition duration-300">
                    {{ isMetronomeRunning ? 'åœæ­¢ç¯€æ‹å™¨' : 'é–‹å§‹ç¯€æ‹å™¨' }}
                </button>
                
                <div class="w-full mt-4">
                    <label for="bpm-slider" class="block text-sm font-medium text-gray-700 mb-2">èª¿æ•´ BPM: {{ bpm }}</label>
                    <input type="range" id="bpm-slider" min="60" max="180" step="1" v-model.number="bpm" 
                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg app-red-slider">
                </div>

            </div>
        </section>

        <section class="grid grid-cols-2 gap-4">
            
            <button @click="callEmergency" 
                    class="flex flex-col items-center justify-center p-6 bg-app-red text-white rounded-xl shadow-lg hover:bg-red-700 transition duration-300 transform hover:scale-[1.02] active:scale-[0.98]">
                <svg class="w-12 h-12 mb-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22 16.92l-3.3-3.3c-.4-.4-.9-.62-1.42-.62h-1.5c-.32 0-.64.08-.94.24-.3.16-.54.4-.68.68-.14.28-.2.6-.14.92l.74 3.7c.08.38 0 .76-.2 1.1-.2.34-.52.56-.9.68L12 20.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5V16.92zM12 2.09c.32 0 .64.08.94.24.3.16.54.4.68.68.14.28.2.6.14.92l.74 3.7c.08.38 0 .76-.2 1.1-.2.34-.52.56-.9.68L12 20.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5V16.92z"/>
                    <path d="M17.5 13.5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5z"/>
                </svg>
                <span class="text-xl font-bold">ä¸€éµå ±æ¡ˆ (119)</span>
            </button>

            <button @click="showCPRModal = true" 
                    class="flex flex-col items-center justify-center p-6 bg-app-white text-app-red border-2 border-app-red rounded-xl shadow-md hover:bg-red-50 transition duration-300 transform hover:scale-[1.02] active:scale-[0.98]">
                <svg class="w-12 h-12 mb-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
                <span class="text-xl font-bold">CPR ä»‹ç´¹èˆ‡æ­¥é©Ÿ</span>
            </button>

        </section>

    </main>
    
    <div v-if="showCPRModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-app-white p-6 rounded-2xl shadow-2xl m-4 w-full max-w-md transform transition-all duration-300 ease-out">
            <h3 class="text-3xl font-bold text-app-red mb-4 border-b-2 border-app-red pb-2">ğŸ©º CPR æ­¥é©Ÿæµç¨‹</h3>
            
            <ol class="list-decimal pl-5 space-y-3 text-gray-700 text-lg">
                <li class="font-semibold">å« (ç¢ºèªç’°å¢ƒèˆ‡æ‚£è€…æ„è­˜)</li>
                <li class="font-semibold">å« (æ’¥æ‰“ 119/112 ç·Šæ€¥é›»è©±æ±‚åŠ©)</li>
                <li class="font-semibold">C (èƒ¸å¤–æŒ‰å£“): 
                    <span class="font-normal text-sm block">èƒ¸éª¨ä¸‹åŠéƒ¨ï¼Œæ·±åº¦è‡³å°‘ 5 å…¬åˆ†ï¼Œé€Ÿç‡ **100-120 æ¬¡/åˆ†**ã€‚</span>
                </li>
                <li class="font-semibold">A (æ‰“é–‹å‘¼å¸é“): 
                    <span class="font-normal text-sm block">å£“é¡æä¸‹å·´ã€‚</span>
                </li>
                <li class="font-semibold">B (äººå·¥å‘¼å¸): 
                    <span class="font-normal text-sm block">æ¯ 30 æ¬¡æŒ‰å£“å¾Œï¼Œçµ¦äºˆ 2 æ¬¡äººå·¥å‘¼å¸ (30:2)ã€‚</span>
                </li>
            </ol>

            <button @click="showCPRModal = false" 
                    class="mt-6 w-full py-3 bg-app-red text-white font-bold rounded-full hover:bg-red-700 transition duration-300">
                é—œé–‰
            </button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, watch, onMounted, onUnmounted } = Vue;

    createApp({
        setup() {
            // --- ç‹€æ…‹å®šç¾© ---
            const isMetronomeRunning = ref(false); // ç¯€æ‹å™¨æ˜¯å¦é‹è¡Œä¸­
            const bpm = ref(120); // ç¯€æ‹é€Ÿåº¦ (BPM: Beats Per Minute)
            const showCPRModal = ref(false); // æ§åˆ¶ CPR å½ˆå‡ºè¦–çª—
            let metronomeInterval = null;
            let audioContext = null;
            let oscillator = null;

            // --- è²éŸ³ç”¢ç”Ÿå™¨ ---
            function setupAudio() {
                if (audioContext === null) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            function playClick() {
                setupAudio();
                
                // å‰µå»ºä¸€å€‹éœ‡ç›ªå™¨
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // è¨­å®šè²éŸ³å±¬æ€§ (çŸ­ä¿ƒçš„æ»´ç­”è²)
                oscillator.type = 'square'; // æ–¹æ³¢
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // é »ç‡ 440 Hz
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);

                // è¨­å®šè²éŸ³çµæŸæ™‚é–“ (éå¸¸çŸ­ä¿ƒ)
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.05); // æ’­æ”¾ 50 æ¯«ç§’
            }

            // --- ç¯€æ‹å™¨é‚è¼¯ ---
            function startMetronome() {
                if (metronomeInterval) {
                    clearInterval(metronomeInterval);
                }
                if (bpm.value < 60) bpm.value = 60; // é˜²æ­¢éä½
                if (bpm.value > 180) bpm.value = 180; // é˜²æ­¢éé«˜

                // è¨ˆç®—æ¯å€‹ç¯€æ‹çš„æ™‚é–“é–“éš” (æ¯«ç§’)
                const intervalTime = (60 / bpm.value) * 1000; 

                metronomeInterval = setInterval(() => {
                    playClick(); // æ’­æ”¾ç¯€å¥è²
                }, intervalTime);

                isMetronomeRunning.value = true;
            }

            function stopMetronome() {
                if (metronomeInterval) {
                    clearInterval(metronomeInterval);
                    metronomeInterval = null;
                }
                isMetronomeRunning.value = false;
            }

            function toggleMetronome() {
                if (isMetronomeRunning.value) {
                    stopMetronome();
                } else {
                    startMetronome();
                }
            }

            // ç›£è½ BPM è®ŠåŒ–ï¼Œè‹¥ç¯€æ‹å™¨é‹è¡Œä¸­å‰‡é‡æ–°å•Ÿå‹•ä»¥æ‡‰ç”¨æ–°é€Ÿåº¦
            watch(bpm, (newBPM, oldBPM) => {
                if (isMetronomeRunning.value) {
                    startMetronome(); 
                }
            });


            // --- ç·Šæ€¥åŠŸèƒ½é‚è¼¯ ---
            function callEmergency() {
                // é€™æ˜¯æ¨¡æ“¬ä¸€éµå ±æ¡ˆï¼Œå¯¦éš›åœ¨æ‰‹æ©Ÿä¸Šæœƒå˜—è©¦æ’¥æ‰“é›»è©±
                const phoneNumber = '119';
                if (confirm(`æ‚¨ç¢ºå®šè¦æ’¥æ‰“ç·Šæ€¥é›»è©± ${phoneNumber} å—ï¼Ÿ`)) {
                    // window.location.href = `tel:${phoneNumber}`; // å¯¦éš›åœ¨æ‰‹æ©Ÿç€è¦½å™¨ä¸­ä½¿ç”¨
                    alert(`æ­£åœ¨æ¨¡æ“¬æ’¥æ‰“ ${phoneNumber}...`);
                }
            }
            
            // --- ç”Ÿå‘½å‘¨æœŸé‰¤å­ (æ¸…ç†å·¥ä½œ) ---
            onUnmounted(() => {
                stopMetronome();
                if (audioContext) {
                    audioContext.close();
                }
            });


            // --- è¿”å›ä¾›æ¨¡æ¿ä½¿ç”¨çš„ç‹€æ…‹å’Œæ–¹æ³• ---
            return {
                isMetronomeRunning,
                bpm,
                showCPRModal,
                toggleMetronome,
                callEmergency,
            };
        }
    }).mount('#app');
</script>

</body>
</html>